#!/usr/bin/env bash
set -o errexit -o pipefail -o xtrace

has_brew=$(echo $PATH | grep -q brew)
if [ ! has_brew ] && [ -d /opt/homebrew ] && [ -n $ZDOTDIR ]; then
  eval $(/opt/homebrew/bin/brew shellenv)
  cat $(/opt/homebrew/bin/brew shellenv) >> $ZDOTDIR/.zshenv
fi

# Brewfile hash: {{ includeTemplate "dot_Brewfile.tmpl" . | sha256sum }}
{{ if or (env "CI") (eq .profile "init") -}}
brew bundle --no-lock --file=/dev/stdin <<EOF
{{ includeTemplate "dot_Brewfile.tmpl" . }}
EOF
{{ else }}
brew bundle --no-lock --global
{{- end }}
